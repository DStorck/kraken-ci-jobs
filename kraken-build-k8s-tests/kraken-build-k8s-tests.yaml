---
- job-template:
  name: '{name}-build-k8-tests'
  project-type: freestyle
  parameters:
    - testing-params
    - string:
      name: KUBE_CONFORMANCE_REPO
      default: git@github.com/kubernetes/kubernetes.git
      description: "Kubernetes conformance tests repo"
    - string:
      name: KUBE_CONFORMANCE_DIR
      default: kubernetes
      description: "where to clone test repo to under /var/lib/docker/gobuild/KUBE_CONFORMANCE_DIR"
  properties:
    - build-discarder:
        days-to-keep: -1
        num-to-keep: 100
        artifact-days-to-keep: -1
        artifact-num-to-keep: -1
    - github:
        url: https://github.com/Samsung-AG/kraken/
    - slack:
        notify-start: true
        notify-success: true
        notify-aborted: true
        notify-failure: true
  wrappers:
    - workspace-cleanup
    - mask-passwords
  builders:
    - conditional-step:
        condition-kind: boolean-expression
        condition-expression: ${{REBUILD_TESTS}}
        steps:
          - shell: 
              !include-raw-escape: include-raw001-kraken-build-k8-tests.sh
  publishers:
    - slack:
        team-domain: '{slack_domain}'
        auth-token: '{slack_api_token}'
        room: '{slack_room}'
        build-server-url: 'https://{ci_hostname}'
